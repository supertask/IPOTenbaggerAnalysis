<!DOCTYPE html>
<html>
<head>
    <title>{{ company_name }} ({{ company_code }}) - åˆ†æ</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { padding-top: 20px; }
        .chart-container { margin-bottom: 30px; }
        .competitor-badge { margin-right: 5px; margin-bottom: 5px; }
        
        /* ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .copy-button {
            background-color: #ffffff;  /* ç™½è‰²ã®èƒŒæ™¯ */
            border: 2px solid #2ecc71;  /* ç·‘è‰²ã®æ ç·š */
            color: #2ecc71;  /* ãƒ†ã‚­ã‚¹ãƒˆã¯ç·‘è‰² */
            position: relative;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(46, 204, 113, 0.2);
        }
        
        .copy-button:hover {
            background-color: #f8f9fa;  /* è–„ã„ã‚°ãƒ¬ãƒ¼ */
            border-color: #27ae60;
            color: #27ae60;
            box-shadow: 0 4px 8px rgba(46, 204, 113, 0.3);
        }
        
        .copy-button:active {
            background-color: #2ecc71;  /* ç·‘è‰²ã®èƒŒæ™¯ */
            border-color: #e9ecef;  /* ç°è‰²ã®æ ç·š */
            color: #ffffff;  /* ç™½è‰²ã®ãƒ†ã‚­ã‚¹ãƒˆ */
            box-shadow: 0 2px 4px rgba(46, 204, 113, 0.2);
        }
        
        /* ã‚¯ãƒªãƒƒã‚¯å¾Œã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¯ãƒ©ã‚¹ */
        .copy-button.clicked {
            background-color: #2ecc71;  /* ç·‘è‰²ã®èƒŒæ™¯ */
            border-color: #e9ecef;  /* ç°è‰²ã®æ ç·š */
            color: #ffffff;  /* ç™½è‰²ã®ãƒ†ã‚­ã‚¹ãƒˆ */
            box-shadow: 0 2px 4px rgba(46, 204, 113, 0.2);
        }
        
        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .copy-button.loading {
            background-color: #f8f9fa;  /* è–„ã„ã‚°ãƒ¬ãƒ¼ */
            border-color: #2ecc71;  /* ç·‘è‰²ã®æ ç·š */
            color: #2ecc71;  /* ãƒ†ã‚­ã‚¹ãƒˆã¯ç·‘è‰² */
            pointer-events: none;  /* ã‚¯ãƒªãƒƒã‚¯ã‚’ç„¡åŠ¹åŒ– */
            opacity: 0.8;
        }
        
        .copy-button.loading .spinner-border {
            width: 1rem;
            height: 1rem;
            margin-right: 8px;
            vertical-align: middle;
        }
        
        .copy-button.loading .original-text {
            display: none;
        }
        
        .copy-button.loading .loading-text {
            display: inline;
        }
        
        .copy-button .loading-text {
            display: none;
        }
        
        /* ã‚¯ãƒªãƒƒã‚¯å¾Œã®å¾©å¸°ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¯ãƒ©ã‚¹ */
        .copy-button.recovering {
            animation: buttonRecoveryEffect 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        @keyframes buttonRecoveryEffect {
            0% {
                background-color: #2ecc71;  /* ç·‘è‰²ã®èƒŒæ™¯ */
                border-color: #e9ecef;  /* ç°è‰²ã®æ ç·š */
                color: #ffffff;  /* ç™½è‰²ã®ãƒ†ã‚­ã‚¹ãƒˆ */
            }
            100% {
                background-color: #ffffff;  /* ç™½è‰²ã®èƒŒæ™¯ */
                border-color: #2ecc71;  /* ç·‘è‰²ã®æ ç·š */
                color: #2ecc71;  /* ç·‘è‰²ã®ãƒ†ã‚­ã‚¹ãƒˆ */
            }
        }
        
        .copy-button i {
            margin-right: 8px;
            font-size: 1.1em;
        }
        
        /* ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        
        .toast {
            background-color: #2ecc71;  /* ãƒœã‚¿ãƒ³ã¨åŒã˜ç·‘è‰² */
            color: white;
            padding: 15px 25px;
            border-radius: 8px;
            margin-bottom: 10px;
            opacity: 0;
            transition: all 0.3s ease-in-out;
            box-shadow: 0 4px 12px rgba(46, 204, 113, 0.3);
            transform: translateY(-10px);
        }
        
        .toast.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row justify-content-center">
            <div class="col-xl-10">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/next_tenbagger/">ãƒ›ãƒ¼ãƒ </a></li>
                        <li class="breadcrumb-item active" aria-current="page">{{ company_name }}</li>
                    </ol>
                </nav>
                
                <h1 class="mb-3">{{ company_name }} <small class="text-muted">({{ company_code }})</small></h1>
                
                <!-- å¤–éƒ¨ãƒªãƒ³ã‚¯ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">å¤–éƒ¨ãƒªãƒ³ã‚¯</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-4 mb-2">
                                <a href="https://irbank.net/{{ company_code }}/ir?mw=2" target="_blank" class="btn btn-outline-primary w-100">
                                    <i class="bi bi-graph-up"></i> IRãƒãƒ³ã‚¯ï¼ˆIRæƒ…å ±ï¼‰
                                </a>
                            </div>
                            <div class="col-md-4 mb-2">
                                <a href="https://irbank.net/{{ company_code }}/per?mw=2" target="_blank" class="btn btn-outline-primary w-100">
                                    <i class="bi bi-bar-chart-line"></i> IRãƒãƒ³ã‚¯ï¼ˆPERæƒ…å ±ï¼‰
                                </a>
                            </div>
                            <div class="col-md-4 mb-2">
                                <a href="https://www.traders.co.jp/ipo/{{ company_code }}" target="_blank" class="btn btn-outline-primary w-100">
                                    <i class="bi bi-building"></i> ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼ã‚ºï¼ˆIPOæƒ…å ±ï¼‰
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">ç«¶åˆä¼æ¥­</h5>
                    </div>
                    <div class="card-body">
                        {% if competitors %}
                            {% for competitor in competitors %}
                            <span class="badge bg-secondary competitor-badge">{{ competitor.name }} ({{ competitor.code }})</span>
                            {% endfor %}
                        {% else %}
                            <div class="alert alert-info">
                                ã“ã®ä¼æ¥­ã®ç«¶åˆä¼æ¥­æƒ…å ±ã¯ã¾ã ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ä»¥ä¸‹ã®ã‚°ãƒ©ãƒ•ã§ã¯ã€ã“ã®ä¼æ¥­ã®è²¡å‹™æŒ‡æ¨™ã®ã¿ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚
                            </div>
                        {% endif %}
                    </div>
                </div>
                
                <!-- äº‹æ¥­ã®å†…å®¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <h2 class="mb-4">äº‹æ¥­ã®å†…å®¹</h2>
                
                <div class="row mb-4">
                    <div class="col-md-6 mb-3">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="mb-0">äº‹æ¥­æƒ…å ±</h5>
                            </div>
                            <div class="card-body">
                                <ul class="nav nav-tabs" id="targetCompanyBusinessTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" 
                                                id="target-company-business-tab" 
                                                data-bs-toggle="tab" 
                                                data-bs-target="#target-company-business" 
                                                type="button" 
                                                role="tab" 
                                                aria-controls="target-company-business" 
                                                aria-selected="true">
                                            {{ company_name }}
                                        </button>
                                    </li>
                                </ul>
                                <div class="tab-content mt-3" id="targetCompanyBusinessTabsContent">
                                    <div class="tab-pane fade show active" 
                                         id="target-company-business" 
                                         role="tabpanel" 
                                         aria-labelledby="target-company-business-tab">
                                        <div style="max-height: 350px; overflow-y: auto;">
                                            {% if business_description %}
                                                <div>{{ business_description|safe }}</div>
                                            {% else %}
                                                <div class="alert alert-warning">
                                                    äº‹æ¥­ã®å†…å®¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {% if competitors %}
                    <div class="col-md-6 mb-3">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="mb-0">ç«¶åˆä¼æ¥­ã®äº‹æ¥­æƒ…å ±</h5>
                            </div>
                            <div class="card-body">
                                <ul class="nav nav-tabs" id="competitorBusinessTabs" role="tablist">
                                    {% for competitor in competitors %}
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link {% if loop.first %}active{% endif %}" 
                                                id="competitor-business-{{ competitor.code }}-tab" 
                                                data-bs-toggle="tab" 
                                                data-bs-target="#competitor-business-{{ competitor.code }}" 
                                                type="button" 
                                                role="tab" 
                                                aria-controls="competitor-business-{{ competitor.code }}" 
                                                aria-selected="{% if loop.first %}true{% else %}false{% endif %}">
                                            {{ competitor.name }}
                                        </button>
                                    </li>
                                    {% endfor %}
                                </ul>
                                <div class="tab-content mt-3" id="competitorBusinessTabsContent">
                                    {% for competitor in competitors %}
                                    <div class="tab-pane fade {% if loop.first %}show active{% endif %}" 
                                         id="competitor-business-{{ competitor.code }}" 
                                         role="tabpanel" 
                                         aria-labelledby="competitor-business-{{ competitor.code }}-tab">
                                        <div style="max-height: 350px; overflow-y: auto;">
                                            {% if competitor.business_description %}
                                                <div>{{ competitor.business_description|safe }}</div>
                                            {% else %}
                                                <div class="alert alert-warning">
                                                    äº‹æ¥­ã®å†…å®¹ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <!-- äº‹æ¥­ã®å†…å®¹ã®æ¯”è¼ƒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ -->
                <div class="text-center mb-4">
                    <div class="btn-group" role="group">
                        <button class="btn copy-button" onclick="copyBusinessComparisonPrompt()">
                            <i class="bi bi-box-arrow-up-right"></i> äº‹æ¥­ã®å†…å®¹ã®æ¯”è¼ƒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
                        </button>
                        <button class="btn btn-success" onclick="openChatGPTWithBusinessPrompt()">
                            <i class="bi bi-chat-dots"></i> ChatGPTã§é–‹ã
                        </button>
                    </div>
                </div>
                
                <!-- å½¹å“¡æƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <h2 class="mb-4">å½¹å“¡ã®çŠ¶æ³</h2>
                
                <div class="row mb-4">
                    <div class="col-md-6 mb-3">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="mb-0">å½¹å“¡æƒ…å ±</h5>
                            </div>
                            <div class="card-body">
                                <ul class="nav nav-tabs" id="targetCompanyTabs" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" 
                                                id="target-company-tab" 
                                                data-bs-toggle="tab" 
                                                data-bs-target="#target-company" 
                                                type="button" 
                                                role="tab" 
                                                aria-controls="target-company" 
                                                aria-selected="true">
                                            {{ company_name }}
                                        </button>
                                    </li>
                                </ul>
                                <div class="tab-content mt-3" id="targetCompanyTabsContent">
                                    <div class="tab-pane fade show active" 
                                         id="target-company" 
                                         role="tabpanel" 
                                         aria-labelledby="target-company-tab">
                                        <div style="max-height: 350px; overflow-y: auto;">
                                            {% if officers_info %}
                                                <div>{{ officers_info|safe }}</div>
                                            {% else %}
                                                <div class="alert alert-warning">
                                                    å½¹å“¡æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {% if competitors %}
                    <div class="col-md-6 mb-3">
                        <div class="card h-100">
                            <div class="card-header">
                                <h5 class="mb-0">ç«¶åˆä¼æ¥­ã®å½¹å“¡æƒ…å ±</h5>
                            </div>
                            <div class="card-body">
                                <ul class="nav nav-tabs" id="competitorTabs" role="tablist">
                                    {% for competitor in competitors %}
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link {% if loop.first %}active{% endif %}" 
                                                id="competitor-{{ competitor.code }}-tab" 
                                                data-bs-toggle="tab" 
                                                data-bs-target="#competitor-{{ competitor.code }}" 
                                                type="button" 
                                                role="tab" 
                                                aria-controls="competitor-{{ competitor.code }}" 
                                                aria-selected="{% if loop.first %}true{% else %}false{% endif %}">
                                            {{ competitor.name }}
                                        </button>
                                    </li>
                                    {% endfor %}
                                </ul>
                                <div class="tab-content mt-3" id="competitorTabsContent">
                                    {% for competitor in competitors %}
                                    <div class="tab-pane fade {% if loop.first %}show active{% endif %}" 
                                         id="competitor-{{ competitor.code }}" 
                                         role="tabpanel" 
                                         aria-labelledby="competitor-{{ competitor.code }}-tab">
                                        <div style="max-height: 350px; overflow-y: auto;">
                                            {% if competitor.officers_info %}
                                                <div>{{ competitor.officers_info|safe }}</div>
                                            {% else %}
                                                <div class="alert alert-warning">
                                                    å½¹å“¡æƒ…å ±ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                
                <!-- å½¹å“¡æƒ…å ±ã®æ¯”è¼ƒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ -->
                <div class="text-center mb-4">
                    <div class="btn-group" role="group">
                        <button class="btn copy-button" onclick="copyOfficersComparisonPrompt()">
                            <i class="bi bi-box-arrow-up-right"></i> å½¹å“¡ã®çŠ¶æ³ã®æ¯”è¼ƒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
                        </button>
                        <button class="btn btn-success" onclick="openChatGPTWithOfficersPrompt()">
                            <i class="bi bi-chat-dots"></i> ChatGPTã§é–‹ã
                        </button>
                    </div>
                </div>
                
                <!-- ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ç”¨ã®ã‚³ãƒ³ãƒ†ãƒŠ -->
                <div class="toast-container"></div>
            </div>
        </div>
    </div>
    
    <!-- è²¡å‹™æŒ‡æ¨™ã®æ¯”è¼ƒã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆãƒšãƒ¼ã‚¸å¹…ã„ã£ã±ã„ã«è¡¨ç¤ºï¼‰ -->
    <div class="container-fluid mt-5">
        <div class="row justify-content-center">
            <div class="col-12">
                <!-- ãƒãƒ£ãƒ¼ãƒˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <h2 class="mb-4">è²¡å‹™æŒ‡æ¨™ã®æ¯”è¼ƒ</h2>
                
                {% if charts %}
                    <div class="row">
                    {% for chart in charts %}
                        <div class="col-12 col-md-6 mb-4">
                            <div class="card h-100">
                                <div class="card-header">
                                    <h5 class="mb-0">{{ chart.title }}</h5>
                                </div>
                                <div class="card-body pb-5">
                                    <div class="chart-container" id="chart-{{ loop.index }}" data-chart="{{ loop.index }}" style="min-height: 350px;"></div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                    </div>
                {% else %}
                    <div class="alert alert-warning">
                        è²¡å‹™æŒ‡æ¨™ã®ãƒãƒ£ãƒ¼ãƒˆã‚’ç”Ÿæˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ç«¶åˆä¼æ¥­ãƒ‡ãƒ¼ã‚¿ã‚’JavaScriptã§åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
        const competitorsData = [
            {% for competitor in competitors %}
            {
                "code": "{{ competitor.code }}",
                "name": "{{ competitor.name }}"
            }{% if not loop.last %},{% endif %}
            {% endfor %}
        ];
        
        // ãƒãƒ£ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã®å®šç¾©
        {% if charts %}
            {% for chart in charts %}
                var chartData{{ loop.index }} = {{ chart.data|tojson|safe }};
                var chartLayout{{ loop.index }} = {{ chart.layout|tojson|safe }};
            {% endfor %}
        {% endif %}
        
        // ===== è¿½åŠ : ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰APIãŒä½¿ãˆãªã„ç’°å¢ƒå‘ã‘ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ (ã‚°ãƒ­ãƒ¼ãƒãƒ«) =====
        function openPromptWindow(text) {
            const newWin = window.open('', '_blank');
            if (!newWin) {
                alert('æ–°ã—ã„ã‚¿ãƒ–ã‚’é–‹ã‘ã¾ã›ã‚“ã§ã—ãŸã€‚ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ãƒ–ãƒ­ãƒƒã‚¯ã‚’è§£é™¤ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            const escaped = text
                .replace(/&/g, '&amp;')
                .replace(/</g, '&lt;')
                .replace(/>/g, '&gt;');
            newWin.document.write('<html><head><meta charset="utf-8"><title>Prompt</title></head><body style="white-space:pre-wrap;font-family:monospace;padding:20px;">' + escaped + '</body></html>');
            newWin.document.close();
        }

        // navigator.clipboard ãŒæœªå®šç¾©ã€ã¾ãŸã¯ writeText ãŒç„¡ã„å ´åˆã®ãƒãƒªãƒ•ã‚£ãƒ«
        if (!navigator.clipboard || !navigator.clipboard.writeText) {
            navigator.clipboard = {
                writeText: function(text) {
                    openPromptWindow(text);
                    return Promise.resolve();
                }
            };
        }
        
        // ãƒãƒ£ãƒ¼ãƒˆã®æç”»
        document.addEventListener('DOMContentLoaded', function() {
            {% if charts %}
                {% for chart in charts %}
                    Plotly.newPlot('chart-{{ loop.index }}', chartData{{ loop.index }}, chartLayout{{ loop.index }}, {responsive: true});
                {% endfor %}
            {% endif %}
            
            // ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤ºé–¢æ•°
            window.showToast = function(message) {
                const toastContainer = document.querySelector('.toast-container');
                const toast = document.createElement('div');
                toast.className = 'toast';
                toast.innerHTML = message;
                toastContainer.appendChild(toast);
                
                // è¡¨ç¤ºã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
                setTimeout(() => {
                    toast.classList.add('show');
                }, 10);
                
                // 3ç§’å¾Œã«éè¡¨ç¤º
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => {
                        toastContainer.removeChild(toast);
                    }, 300);
                }, 3000);
            };

            // äº‹æ¥­ã®å†…å®¹ã®æ¯”è¼ƒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹é–¢æ•°
            function copyBusinessComparisonPrompt() {
                var button = document.querySelector('.copy-button[onclick="copyBusinessComparisonPrompt()"]');
                
                // ãƒœã‚¿ãƒ³ã®å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿å­˜
                var originalHtml = button.innerHTML;
                
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã«å¤‰æ›´
                button.classList.add('loading');
                button.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="loading-text">å‡¦ç†ä¸­...</span><span class="original-text">' + originalHtml + '</span>';
                
                // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆä¼æ¥­ã®äº‹æ¥­ã®å†…å®¹ã‚’å–å¾—
                var targetBusiness = document.querySelector('#target-company-business').textContent.trim();
                
                // ç«¶åˆä¼æ¥­ã®äº‹æ¥­ã®å†…å®¹ã‚’å–å¾—
                var competitorElements = document.querySelectorAll('[id^="competitor-business-"]:not([id$="-tab"])');
                var competitorInfo = Array.from(competitorElements).map(function(el) {
                    return el.textContent.trim();
                });
                
                // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆ
                var promptText = "ä¸‹è¨˜ã¯ã€ãã‚Œãã‚Œã®ä¼æ¥­ã®äº‹æ¥­ã®å†…å®¹ã§ã™ã€‚ãƒ†ãƒ³ãƒã‚¬ãƒ¼ã®ä¼æ¥­ã‚’é¸ã¶éš›ã«ã“ã‚Œã‚‰ã®äº‹æ¥­å†…å®¹ã ã‘ã®æƒ…å ±ã‹ã‚‰ã€ã©ã®ä¼šç¤¾ãŒä¼¸ã³ãã†ã ã¨æ€ã†ã‹äºˆæ¸¬ã—ç†ç”±ã‚’æ•™ãˆã¦\n\n";
                var companyName = '{{ company_name }}';
                var businessText = "ã€" + companyName + "ã®äº‹æ¥­ã®å†…å®¹ã€‘\n" + targetBusiness + "\n\n";
                
                // ç«¶åˆä¼æ¥­ã®æƒ…å ±ã‚’è¿½åŠ 
                var competitorsText = competitorInfo.map(function(info, index) {
                    return "ã€" + competitorsData[index].name + "ã®äº‹æ¥­ã®å†…å®¹ã€‘\n" + info;
                }).join('\n\n');
                
                // å…¨ãƒ†ã‚­ã‚¹ãƒˆã‚’çµåˆ
                var fullText = promptText + businessText + competitorsText;

                // ç›´æ¥ã‚¿ãƒ–ã‚’é–‹ã
                openPromptWindow(fullText);
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’è§£é™¤
                button.classList.remove('loading');
                // æˆåŠŸçŠ¶æ…‹ã«å¤‰æ›´
                button.classList.add('clicked');
                button.innerHTML = originalHtml;
                // ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
                showToast('ã‚¿ãƒ–ã‚’é–‹ãã¾ã—ãŸï¼');
                setTimeout(function() {
                    button.classList.remove('clicked');
                    button.classList.add('recovering');
                    setTimeout(function() {
                        button.classList.remove('recovering');
                    }, 500);
                }, 1000);
            }

            // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã¸å…¬é–‹
            window.copyBusinessComparisonPrompt = copyBusinessComparisonPrompt;
 
            // å½¹å“¡æƒ…å ±ã®æ¯”è¼ƒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹é–¢æ•°
            function copyOfficersComparisonPrompt() {
                var button = document.querySelector('.copy-button[onclick="copyOfficersComparisonPrompt()"]');
                
                // ãƒœã‚¿ãƒ³ã®å…ƒã®ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿å­˜
                var originalHtml = button.innerHTML;
                
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã«å¤‰æ›´
                button.classList.add('loading');
                button.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span><span class="loading-text">å‡¦ç†ä¸­...</span><span class="original-text">' + originalHtml + '</span>';
                
                // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆä¼æ¥­ã®å½¹å“¡æƒ…å ±ã‚’å–å¾—
                var targetOfficers = document.querySelector('#target-company').textContent.trim();
                
                // ç«¶åˆä¼æ¥­ã®å½¹å“¡æƒ…å ±ã‚’å–å¾—
                var competitorElements = document.querySelectorAll('[id^="competitor-"]:not([id$="-tab"]):not([id^="competitor-business-"])');
                var competitorInfo = Array.from(competitorElements).map(function(el) {
                    return el.textContent.trim();
                });
                
                // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆ
                var promptText = "ä¸‹è¨˜ã¯ã€ãã‚Œãã‚Œã®ä¼æ¥­ã®å½¹å“¡ã®çŠ¶æ³ã§ã™ã€‚ãƒ†ãƒ³ãƒã‚¬ãƒ¼ã®ä¼æ¥­ã‚’é¸ã¶éš›ã«ã“ã‚Œã‚‰ã®å½¹å“¡ã ã‘ã®æƒ…å ±ã‹ã‚‰ã€ã©ã®ä¼šç¤¾ãŒä¼¸ã³ãã†ã ã¨æ€ã†ã‹äºˆæ¸¬ã—ç†ç”±ã‚’æ•™ãˆã¦\n\n";
                var companyName = '{{ company_name }}';
                var officersText = "ã€" + companyName + "ã®å½¹å“¡ã®çŠ¶æ³ã€‘\n" + targetOfficers + "\n\n";
                
                // ç«¶åˆä¼æ¥­ã®æƒ…å ±ã‚’è¿½åŠ 
                var competitorsText = competitorInfo.map(function(info, index) {
                    return "ã€" + competitorsData[index].name + "ã®å½¹å“¡ã®çŠ¶æ³ã€‘\n" + info;
                }).join('\n\n');
                
                // å…¨ãƒ†ã‚­ã‚¹ãƒˆã‚’çµåˆ
                var fullText = promptText + officersText + competitorsText;
                
                // ç›´æ¥ã‚¿ãƒ–ã‚’é–‹ã
                openPromptWindow(fullText);
                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹ã‚’è§£é™¤
                button.classList.remove('loading');
                // æˆåŠŸçŠ¶æ…‹ã«å¤‰æ›´
                button.classList.add('clicked');
                button.innerHTML = originalHtml;
                // ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
                showToast('ã‚¿ãƒ–ã‚’é–‹ãã¾ã—ãŸï¼');
                setTimeout(function() {
                    button.classList.remove('clicked');
                    button.classList.add('recovering');
                    setTimeout(function() {
                        button.classList.remove('recovering');
                    }, 500);
                }, 1000);
            }

            window.copyOfficersComparisonPrompt = copyOfficersComparisonPrompt;
            
            // ChatGPTã§äº‹æ¥­ã®å†…å®¹ã®æ¯”è¼ƒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’é–‹ãé–¢æ•°
            function openChatGPTWithBusinessPrompt() {
                // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆä¼æ¥­ã®äº‹æ¥­ã®å†…å®¹ã‚’å–å¾—
                var targetBusiness = document.querySelector('#target-company-business').textContent.trim();
                
                // ç«¶åˆä¼æ¥­ã®äº‹æ¥­ã®å†…å®¹ã‚’å–å¾—
                var competitorElements = document.querySelectorAll('[id^="competitor-business-"]:not([id$="-tab"])');
                var competitorInfo = Array.from(competitorElements).map(function(el) {
                    return el.textContent.trim();
                });
                
                // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆ
                var promptText = "ä¸‹è¨˜ã¯ã€ãã‚Œãã‚Œã®ä¼æ¥­ã®äº‹æ¥­ã®å†…å®¹ã§ã™ã€‚ãƒ†ãƒ³ãƒã‚¬ãƒ¼ã®ä¼æ¥­ã‚’é¸ã¶éš›ã«ã“ã‚Œã‚‰ã®äº‹æ¥­å†…å®¹ã ã‘ã®æƒ…å ±ã‹ã‚‰ã€ã©ã®ä¼šç¤¾ãŒä¼¸ã³ãã†ã ã¨æ€ã†ã‹äºˆæ¸¬ã—ç†ç”±ã‚’æ•™ãˆã¦\n\n";
                var companyName = '{{ company_name }}';
                var businessText = "ã€" + companyName + "ã®äº‹æ¥­ã®å†…å®¹ã€‘\n" + targetBusiness + "\n\n";
                
                // ç«¶åˆä¼æ¥­ã®æƒ…å ±ã‚’è¿½åŠ 
                var competitorsText = competitorInfo.map(function(info, index) {
                    return "ã€" + competitorsData[index].name + "ã®äº‹æ¥­ã®å†…å®¹ã€‘\n" + info;
                }).join('\n\n');
                
                // å…¨ãƒ†ã‚­ã‚¹ãƒˆã‚’çµåˆ
                var fullText = promptText + businessText + competitorsText;
                
                // ChatGPTã‚’é–‹ã„ã¦æµ®å‹•ãƒœã‚¿ãƒ³ã‚’ä½œæˆ
                var chatWindow = window.open('https://chatgpt.com/', '_blank');
                
                // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã®ã‚’å¾…ã£ã¦ã‹ã‚‰æµ®å‹•ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
                setTimeout(function() {
                    if (chatWindow && !chatWindow.closed) {
                        try {
                            // æµ®ã‹ã›ã‚‹divè¦ç´ ã‚’ä½œæˆ
                            var toggleDiv = chatWindow.document.createElement("div");
                            toggleDiv.id = "floatingPromptDiv";
                            toggleDiv.style.position = "fixed";
                            toggleDiv.style.display = "flex";
                            toggleDiv.style.top = "20px";
                            toggleDiv.style.right = "20px";
                            toggleDiv.style.width = "60px";
                            toggleDiv.style.height = "60px";
                            toggleDiv.style.backgroundColor = "rgba(16, 163, 127, 0.9)";
                            toggleDiv.style.color = "white";
                            toggleDiv.style.borderRadius = "50%";
                            toggleDiv.style.alignItems = "center";
                            toggleDiv.style.justifyContent = "center";
                            toggleDiv.style.cursor = "pointer";
                            toggleDiv.style.zIndex = "10000";
                            toggleDiv.style.fontSize = "24px";
                            toggleDiv.innerHTML = "ğŸ“";
                            toggleDiv.title = "ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›";
                            
                            // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
                            toggleDiv.addEventListener("click", function() {
                                try {
                                    // ChatGPTã®å…¥åŠ›æ¬„ã‚’ç‰¹å®š
                                    var inputField = chatWindow.document.getElementById("prompt-textarea") || 
                                                   chatWindow.document.querySelector(".ProseMirror") ||
                                                   chatWindow.document.querySelector('textarea[placeholder*="Message"]') ||
                                                   chatWindow.document.querySelector('div[contenteditable="true"]');
                                    
                                    if (inputField) {
                                        // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’è¨­å®š
                                        inputField.focus();
                                        
                                        if (inputField.tagName === 'TEXTAREA') {
                                            inputField.value = fullText;
                                            inputField.dispatchEvent(new Event("input", { bubbles: true }));
                                        } else {
                                            inputField.textContent = fullText;
                                            inputField.dispatchEvent(new Event("input", { bubbles: true }));
                                        }
                                        
                                        // ãƒœã‚¿ãƒ³ã‚’å‰Šé™¤
                                        toggleDiv.remove();
                                    } else {
                                        alert("å…¥åŠ›æ¬„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ãƒšãƒ¼ã‚¸ãŒå®Œå…¨ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ã¾ã§ãŠå¾…ã¡ãã ã•ã„ã€‚");
                                    }
                                } catch (error) {
                                    console.error("ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›ã‚¨ãƒ©ãƒ¼:", error);
                                    alert("ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å…¥åŠ›ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                                }
                            });
                            
                            // divã‚’ãƒšãƒ¼ã‚¸ã«è¿½åŠ 
                            chatWindow.document.body.appendChild(toggleDiv);
                        } catch (error) {
                            console.error("æµ®å‹•ãƒœã‚¿ãƒ³ã®ä½œæˆã«å¤±æ•—:", error);
                        }
                    }
                }, 3000);
                
                // ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
                showToast('ChatGPTã‚’é–‹ãã¾ã—ãŸï¼');
            }
            
            // ChatGPTã§å½¹å“¡ã®çŠ¶æ³ã®æ¯”è¼ƒãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’é–‹ãé–¢æ•°
            function openChatGPTWithOfficersPrompt() {
                // ã‚¿ãƒ¼ã‚²ãƒƒãƒˆä¼æ¥­ã®å½¹å“¡æƒ…å ±ã‚’å–å¾—
                var targetOfficers = document.querySelector('#target-company').textContent.trim();
                
                // ç«¶åˆä¼æ¥­ã®å½¹å“¡æƒ…å ±ã‚’å–å¾—
                var competitorElements = document.querySelectorAll('[id^="competitor-"]:not([id$="-tab"]):not([id^="competitor-business-"])');
                var competitorInfo = Array.from(competitorElements).map(function(el) {
                    return el.textContent.trim();
                });
                
                // ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ†ã‚­ã‚¹ãƒˆã‚’ä½œæˆ
                var promptText = "ä¸‹è¨˜ã¯ã€ãã‚Œãã‚Œã®ä¼æ¥­ã®å½¹å“¡ã®çŠ¶æ³ã§ã™ã€‚ãƒ†ãƒ³ãƒã‚¬ãƒ¼ã®ä¼æ¥­ã‚’é¸ã¶éš›ã«ã“ã‚Œã‚‰ã®å½¹å“¡ã ã‘ã®æƒ…å ±ã‹ã‚‰ã€ã©ã®ä¼šç¤¾ãŒä¼¸ã³ãã†ã ã¨æ€ã†ã‹äºˆæ¸¬ã—ç†ç”±ã‚’æ•™ãˆã¦\n\n";
                var companyName = '{{ company_name }}';
                var officersText = "ã€" + companyName + "ã®å½¹å“¡ã®çŠ¶æ³ã€‘\n" + targetOfficers + "\n\n";
                
                // ç«¶åˆä¼æ¥­ã®æƒ…å ±ã‚’è¿½åŠ 
                var competitorsText = competitorInfo.map(function(info, index) {
                    return "ã€" + competitorsData[index].name + "ã®å½¹å“¡ã®çŠ¶æ³ã€‘\n" + info;
                }).join('\n\n');
                
                // å…¨ãƒ†ã‚­ã‚¹ãƒˆã‚’çµåˆ
                var fullText = promptText + officersText + competitorsText;
                
                // ChatGPTã‚’é–‹ã„ã¦æµ®å‹•ãƒœã‚¿ãƒ³ã‚’ä½œæˆ
                var chatWindow = window.open('https://chatgpt.com/', '_blank');
                
                // ãƒšãƒ¼ã‚¸ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã®ã‚’å¾…ã£ã¦ã‹ã‚‰æµ®å‹•ãƒœã‚¿ãƒ³ã‚’è¿½åŠ 
                setTimeout(function() {
                    if (chatWindow && !chatWindow.closed) {
                        try {
                            // æµ®ã‹ã›ã‚‹divè¦ç´ ã‚’ä½œæˆ
                            var toggleDiv = chatWindow.document.createElement("div");
                            toggleDiv.id = "floatingPromptDiv";
                            toggleDiv.style.position = "fixed";
                            toggleDiv.style.display = "flex";
                            toggleDiv.style.top = "20px";
                            toggleDiv.style.right = "20px";
                            toggleDiv.style.width = "60px";
                            toggleDiv.style.height = "60px";
                            toggleDiv.style.backgroundColor = "rgba(16, 163, 127, 0.9)";
                            toggleDiv.style.color = "white";
                            toggleDiv.style.borderRadius = "50%";
                            toggleDiv.style.alignItems = "center";
                            toggleDiv.style.justifyContent = "center";
                            toggleDiv.style.cursor = "pointer";
                            toggleDiv.style.zIndex = "10000";
                            toggleDiv.style.fontSize = "24px";
                            toggleDiv.innerHTML = "ğŸ“";
                            toggleDiv.title = "ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥åŠ›";
                            
                            // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¿½åŠ 
                            toggleDiv.addEventListener("click", function() {
                                try {
                                    // ChatGPTã®å…¥åŠ›æ¬„ã‚’ç‰¹å®š
                                    var inputField = chatWindow.document.getElementById("prompt-textarea") || 
                                                   chatWindow.document.querySelector(".ProseMirror") ||
                                                   chatWindow.document.querySelector('textarea[placeholder*="Message"]') ||
                                                   chatWindow.document.querySelector('div[contenteditable="true"]');
                                    
                                    if (inputField) {
                                        // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’è¨­å®š
                                        inputField.focus();
                                        
                                        if (inputField.tagName === 'TEXTAREA') {
                                            inputField.value = fullText;
                                            inputField.dispatchEvent(new Event("input", { bubbles: true }));
                                        } else {
                                            inputField.textContent = fullText;
                                            inputField.dispatchEvent(new Event("input", { bubbles: true }));
                                        }
                                        
                                        // ãƒœã‚¿ãƒ³ã‚’å‰Šé™¤
                                        toggleDiv.remove();
                                    } else {
                                        alert("å…¥åŠ›æ¬„ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ãƒšãƒ¼ã‚¸ãŒå®Œå…¨ã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ã¾ã§ãŠå¾…ã¡ãã ã•ã„ã€‚");
                                    }
                                } catch (error) {
                                    console.error("ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå…¥åŠ›ã‚¨ãƒ©ãƒ¼:", error);
                                    alert("ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å…¥åŠ›ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
                                }
                            });
                            
                            // divã‚’ãƒšãƒ¼ã‚¸ã«è¿½åŠ 
                            chatWindow.document.body.appendChild(toggleDiv);
                        } catch (error) {
                            console.error("æµ®å‹•ãƒœã‚¿ãƒ³ã®ä½œæˆã«å¤±æ•—:", error);
                        }
                    }
                }, 3000);
                
                // ãƒˆãƒ¼ã‚¹ãƒˆè¡¨ç¤º
                showToast('ChatGPTã‚’é–‹ãã¾ã—ãŸï¼');
            }
            
            // ã‚°ãƒ­ãƒ¼ãƒãƒ«ã¸å…¬é–‹
            window.openChatGPTWithBusinessPrompt = openChatGPTWithBusinessPrompt;
            window.openChatGPTWithOfficersPrompt = openChatGPTWithOfficersPrompt;
        });
    </script>
</body>
</html> 